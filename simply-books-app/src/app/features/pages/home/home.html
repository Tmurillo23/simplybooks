<!-- üîç Buscador arriba -->
<div class="search-bar">
  <input
    type="text"
    placeholder="Buscar libro por t√≠tulo o autor..."
    [value]="search()"
    (input)="search.set($any($event.target).value)"
  />
</div>

<!-- Contenedor principal de las cards -->
<section id="bookshelves">
  @if (filteredBooks().length > 0) {
    @for (book of filteredBooks(); track book.id) {
      <article class="book-card">

        <!-- Portada clickeable que va al detalle -->
        <a [routerLink]="['/book', book.id]">
          <img
            [src]="book.portrait_url || 'assets/default-cover.jpg'"
            [alt]="book.title"
            class="book-cover"
          />
        </a>

        <div class="book-details">
          <!-- T√≠tulo clickeable que va al detalle -->
          <h3>
            <a [routerLink]="['/book', book.id]">{{ book.title }}</a>
          </h3>

          <p><strong>Autor:</strong> {{ book.author || 'No especificado' }}</p>
          <p><strong>A√±o:</strong> {{ book.year || 'No especificado' }}</p>
          <p><strong>Le√≠das:</strong> {{ book.pages_read }} / {{ book.pages }}</p>
          <p><strong>Rating:</strong> {{ book.rating }} ‚≠ê</p>

          <label style="margin-top: 0.3rem;">Estado:</label>
          <select
            [(ngModel)]="book.reading_status"
            name="reading_status"
            (click)="$event.stopPropagation()"
            (change)="$event.stopPropagation()"
            style="font-size: 0.7rem; padding: 0.2rem; margin-top: 0.1rem;"
          >
            <option value="Por leer">Por leer</option>
            <option value="Leyendo">Leyendo</option>
            <option value="Pausado">Pausado</option>
            <option value="Le√≠do">Completado</option>
            <option value="Abandonado">Abandonado</option>
          </select>

          <!-- Botones de acci√≥n -->
          <div style="margin-top: 0.4rem;">
            <button
              [routerLink]="['/editbook', book.id]"
              (click)="$event.stopPropagation()"
              style="font-size: 0.7rem; margin-right: 0.2rem;"
            >
              Editar
            </button>

            <button
              (click)="removeBook(book.id); $event.stopPropagation()"
              style="font-size: 0.7rem;"
            >
              Eliminar
            </button>
          </div>

          <!-- Bot√≥n de descarga solo si tiene archivo -->
          @if (book.file_url) {
            <button
              (click)="downloadFile(book); $event.stopPropagation()"
              class="download-btn"
              style="margin-top: 0.4rem; font-size: 0.7rem;"
            >
              üì• Descargar PDF
            </button>
          }
        </div>
      </article>
    }
  } @else {
    <div class="empty-state">
      <p>A√∫n no tienes libros en tu biblioteca</p>
      <a [routerLink]="['/upload']" class="add-books-link">
        ‚ûï Agregar libros
      </a>
    </div>
  }
</section>
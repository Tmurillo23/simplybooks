<div class="loan-container">
  <h2>Registrar PrÃ©stamo</h2>

  <form (ngSubmit)="addLoan()">
    <div>
      <label>Beneficiario:</label>
      <input
        type="text"
        [(ngModel)]="newLoan.beneficiary"
        name="beneficiary"
        placeholder="Nombre del beneficiario"
        required>
    </div>

    <div>
      <label>Libro:</label>
      <select [(ngModel)]="newLoan.book" name="book" required>
        <option [ngValue]="null" disabled selected>Selecciona un libro</option>
        @for (book of availableBooks; track book.id) {
          <option [ngValue]="book">
            {{ book.title }} - {{ book.author }}
          </option>
        }
      </select>

      @if (availableBooks.length === 0) {
        <p class="no-books">
          ðŸ“š No hay libros fÃ­sicos disponibles para prÃ©stamo.
          <br>
          <small>(Los libros digitales no se pueden prestar)</small>
        </p>
      }
    </div>

    <div>
      <label>Fecha de PrÃ©stamo:</label>
      <input
        type="date"
        [(ngModel)]="newLoan.loanDate"
        name="loanDate"
        required>
    </div>

    <button type="submit">Registrar PrÃ©stamo</button>
  </form>

    <div class="history-button">
      <button [routerLink]="['/loan-history']">
        ðŸ“œ Ver Historial de PrÃ©stamos
      </button>
    </div>


  <h2>PrÃ©stamos Activos</h2>
  @if (activeLoans && activeLoans.length > 0) {
    <div class="loans-summary">
      <p>ðŸ“Š Tienes <strong>{{ activeLoans.length }}</strong> prÃ©stamo(s) activo(s)</p>
    </div>

    <table>
      <thead>
      <tr>
        <th>Beneficiario</th>
        <th>Libro</th>
        <th>Autor</th>
        <th>Fecha de PrÃ©stamo</th>
        <th>DÃ­as Prestado</th>
        <th>Acciones</th>
      </tr>
      </thead>
      <tbody>
        @for (loan of activeLoans; track loan.id) {
          <tr>
            <td>{{ loan.beneficiary }}</td>
            <td>{{ loan.book.title }}</td>
            <td>{{ loan.book.author }}</td>
            <td>{{ loan.loanDate }}</td>
            <td>
              {{ calculateDaysSinceLoan(loan.loanDate) }} dÃ­as
            </td>
            <td>
              <button
                class="btn-return"
                (click)="markReturned(loan)">
                âœ“ Marcar como devuelto
              </button>
            </td>
          </tr>
        }
      </tbody>
    </table>
  } @else {
    <div class="empty-state">
      <p>ðŸ“– No hay prÃ©stamos activos en este momento</p>
    </div>
  }
</div>

<div class="review-detail-container">
  <section class="review-info" [hidden]="!review">
    <h2 class="review-title">{{ review?.title }}</h2>
    <p><strong>Libro:</strong> {{ review?.bookId }}</p>
    <p><strong>Calificación:</strong> {{ review?.rating }}★</p>
    <div class="form-group">
      <label>Reseña:</label>
      <editor
        apiKey="pxpbdo4sfu85q6419mupyj9wdmhonxkw1x2uopi33acnrehl"
        [init]="readonlyEditorConfig"
        [ngModel]="review?.content || '' "
      ></editor>
    </div>

    <p>
      <strong>Estado:</strong>
      <span [class.draft]="review?.draft" [class.published]="!review?.draft">
        {{ review?.draft ? 'Borrador' : 'Publicado' }}
      </span>
    </p>

    <div class="likes-section" [hidden]="review?.draft">
      <button
        (click)="toggleReviewLike()"
        [class.liked]="hasUserLikedReview()"
        class="like-btn"
      >
        ❤️ {{ review?.likes }} Me gusta
      </button>
    </div>

    <a [routerLink]="['/reviews']" class="back-link">← Volver a mis reseñas</a>
  </section>

  <section class="comments-section" [hidden]="review?.draft">
    <h3>Comentarios</h3>

    <div class="new-comment">
    <textarea
      [(ngModel)]="newComment"
      rows="3"
      placeholder="Escribe un comentario..."
    ></textarea>
      <button (click)="addComment()">Comentar</button>
    </div>

    @if (comments.length === 0) {
      <p>Aún no hay comentarios.</p>
    } @else {
      @for (comment of comments; track comment.id) {
        <app-comment-item
          [comment]="comment"
          [replyingTo]="replyingTo"
          [newComment]="newComment"
          [level]="0"
        ></app-comment-item>
      }
    }
  </section>

  <section class="draft-warning" [hidden]="!review?.draft">
    <p class="warning-message">
      Esta reseña es un <strong>borrador</strong>. No puede recibir comentarios ni reacciones hasta que sea publicada.
    </p>
  </section>

  <p [hidden]="review">La reseña no fue encontrada.</p>
</div>
